(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[251],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=d(n),h=r,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||i;return n?a.createElement(m,l(l({ref:t},p),{},{components:n})):a.createElement(m,l({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7265:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return s},toc:function(){return d},default:function(){return u}});var a=n(2122),r=n(9756),i=(n(7294),n(3905)),l=["components"],o={sidebar_position:2},s={unversionedId:"host/install-ubuntu",id:"host/install-ubuntu",isDocsHomePage:!1,title:"Install on Ubuntu",description:"While the following guide will show you how to install HuddleUp on a single server running Ubuntu, it is not required to do so exactly. There are different ways to install and serve HuddleUp. However, we will currently only document this approach.",source:"@site/docs/host/install-ubuntu.md",sourceDirName:"host",slug:"/host/install-ubuntu",permalink:"/handbook/de/docs/host/install-ubuntu",editUrl:"https://github.com/huddle-up/handbook/edit/master/docs/host/install-ubuntu.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSideBar",previous:{title:"Hosting HuddleUp",permalink:"/handbook/de/docs/host/intro"},next:{title:"Configuration",permalink:"/handbook/de/docs/host/configuration"}},d=[{value:"Preparations",id:"preparations",children:[]},{value:"Install requirements",id:"install-requirements",children:[]},{value:"Configure PostgreSQL",id:"configure-postgresql",children:[]},{value:"Create a system user",id:"create-a-system-user",children:[]},{value:"Setup the database",id:"setup-the-database",children:[]},{value:"Download the application",id:"download-the-application",children:[]},{value:"Configure HuddleUp",id:"configure-huddleup",children:[{value:"Client",id:"client",children:[]},{value:"Backend",id:"backend",children:[]}]},{value:"Building the Application",id:"building-the-application",children:[{value:"Running migrations",id:"running-migrations",children:[]}]},{value:"Setup PM2",id:"setup-pm2",children:[]},{value:"Setup Nginx",id:"setup-nginx",children:[{value:"Basic Configuration",id:"basic-configuration",children:[]},{value:"Lets Encrypt",id:"lets-encrypt",children:[]}]}],p={toc:d};function u(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"While the following guide will show you how to install ",(0,i.kt)("em",{parentName:"p"},"HuddleUp")," on a single server running Ubuntu, it is not required to do so exactly. There are different ways to install and serve ",(0,i.kt)("em",{parentName:"p"},"HuddleUp"),". However, we will currently only document this approach."))),(0,i.kt)("p",null,"This guide will show you how to install ",(0,i.kt)("em",{parentName:"p"},"HuddleUp")," on a single server running Ubuntu. We will use ",(0,i.kt)("a",{parentName:"p",href:"https://pm2.keymetrics.io"},"PM2")," for keeping our backend running and running the build process for the frontend."),(0,i.kt)("h2",{id:"preparations"},"Preparations"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Make sure you have shell access to the server and your user has sudo rights"),(0,i.kt)("li",{parentName:"ul"},"You need two domains pointing to the IP of the server, these can also be subdomains",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"One for the frontend (we'll use ",(0,i.kt)("inlineCode",{parentName:"li"},"huddle.huddle-up.org"),")"),(0,i.kt)("li",{parentName:"ul"},"One for the backend (we'll use ",(0,i.kt)("inlineCode",{parentName:"li"},"api.hudde.huddle-up.org"),")")))),(0,i.kt)("h2",{id:"install-requirements"},"Install requirements"),(0,i.kt)("p",null,"First, make sure all package mirrors and installed packages are up to date."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt upgrade -y\n")),(0,i.kt)("p",null,"Now, let's install the dependencies."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl -fsSL https://deb.nodesource.com/setup_14.x | sudo bash -\n\nsudo apt install -y nginx postgresql postgresql-contrib nodejs certbot python3-certbot-nginx\n\nsudo npm install -g pm2@latest yarn\n")),(0,i.kt)("h2",{id:"configure-postgresql"},"Configure PostgreSQL"),(0,i.kt)("p",null,"Next, we will create a PostgreSQL admin user and another user for ",(0,i.kt)("em",{parentName:"p"},"HuddleUp"),". We will use ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," as the username for the administrator and ",(0,i.kt)("inlineCode",{parentName:"p"},"huddleup")," for the application user. You can of course choose different ones, if you want to."),(0,i.kt)("p",null,"First switch to the PostgreSQL system user."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo -i -u postgres\n")),(0,i.kt)("p",null,"Next, create the admin user. When prompted, choose the following answers:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Name of role: ",(0,i.kt)("inlineCode",{parentName:"li"},"admin")),(0,i.kt)("li",{parentName:"ul"},"Password: Choose a strong password and save it somewhere safe!"),(0,i.kt)("li",{parentName:"ul"},"Superuser? ",(0,i.kt)("inlineCode",{parentName:"li"},"y"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"createuser --interactive -P\n")),(0,i.kt)("p",null,"Repeat the process for the application user. When prompted, choose the following answers:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Name of role: ",(0,i.kt)("inlineCode",{parentName:"li"},"huddleup")),(0,i.kt)("li",{parentName:"ul"},"Password: Choose a strong password (not the same as ",(0,i.kt)("inlineCode",{parentName:"li"},"admin"),") and save it somewhere safe!"),(0,i.kt)("li",{parentName:"ul"},"Superuser? ",(0,i.kt)("inlineCode",{parentName:"li"},"n")),(0,i.kt)("li",{parentName:"ul"},"Allow to create databases? ",(0,i.kt)("inlineCode",{parentName:"li"},"y")),(0,i.kt)("li",{parentName:"ul"},"Allow to create roles? ",(0,i.kt)("inlineCode",{parentName:"li"},"n"))),(0,i.kt)("p",null,"We will finalize the database setup in a further step."),(0,i.kt)("p",null,"We're done with Postgres for now, so we will switch back to your main user."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"exit\n")),(0,i.kt)("h2",{id:"create-a-system-user"},"Create a system user"),(0,i.kt)("p",null,"Next we will create a system group and user for ",(0,i.kt)("em",{parentName:"p"},"HuddleUp"),"."),(0,i.kt)("p",null,"First, create the system user group:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo addgroup huddleup\n")),(0,i.kt)("p",null,"Next, create the system user. The following command will create a user named ",(0,i.kt)("inlineCode",{parentName:"p"},"huddleup"),", with ",(0,i.kt)("inlineCode",{parentName:"p"},"huddleup")," as its primary group, add it to the ",(0,i.kt)("inlineCode",{parentName:"p"},"www-data")," group, create a home directory for it and set its default shell to bash."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo useradd -g huddleup -G www-data -m -s /usr/bin/bash huddleup\n")),(0,i.kt)("p",null,"If you want to be able to login as the system user, set its password with the following command. Again, use a ",(0,i.kt)("em",{parentName:"p"},"unique"),", strong password and store it somewhere safe."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo passwd huddleup\n")),(0,i.kt)("h2",{id:"setup-the-database"},"Setup the database"),(0,i.kt)("p",null,"Now, we'll finish the database setup. The next two commands will create a database called ",(0,i.kt)("inlineCode",{parentName:"p"},"huddleup")," and then enable the ",(0,i.kt)("inlineCode",{parentName:"p"},"uuid")," extension, which is required by ",(0,i.kt)("em",{parentName:"p"},"HuddleUp"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo -u huddleup createdb huddleup\n# When prompted for a password, use the one assigned to the database admin user\npsql -h localhost -d huddleup -U admin -W -c 'CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";'\n")),(0,i.kt)("h2",{id:"download-the-application"},"Download the application"),(0,i.kt)("p",null,"Now it's time to download ",(0,i.kt)("em",{parentName:"p"},"HuddleUp")," and prepare its environment."),(0,i.kt)("p",null,"First create a folder in ",(0,i.kt)("inlineCode",{parentName:"p"},"/var")," to install the application in it and set ",(0,i.kt)("inlineCode",{parentName:"p"},"huddleup")," as the owner of it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir /var/huddleup && sudo chown huddleup:huddleup /var/huddleup/\n")),(0,i.kt)("p",null,"Now, switch to the ",(0,i.kt)("inlineCode",{parentName:"p"},"huddleup")," user and clone the ",(0,i.kt)("em",{parentName:"p"},"HuddleUp")," repository."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo -i -u huddleup\ncd /var/huddleup\ngit clone --depth 1 --branch v1.0 https://github.com/huddle-up/huddle-up.git\n")),(0,i.kt)("p",null,"Next, we will install the package dependencies."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd huddle-up\nyarn && yarn bootstrap\n")),(0,i.kt)("h2",{id:"configure-huddleup"},"Configure HuddleUp"),(0,i.kt)("p",null,"Now it's time to configure ",(0,i.kt)("em",{parentName:"p"},"HuddleUp"),". We'll just put some examples here, for more information on the configuration of ",(0,i.kt)("em",{parentName:"p"},"HuddleUp"),", see ",(0,i.kt)("a",{parentName:"p",href:"/handbook/de/docs/host/configuration"},"here"),"."),(0,i.kt)("p",null,"All configuration files are located in the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/")," folder of the application. For this example, we'll use the public Jitsi Meet instance."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The domain and the OpenID Connect provider in this example do not exist. You will have to replace them with your own specific values."))),(0,i.kt)("h3",{id:"client"},"Client"),(0,i.kt)("p",null,"Create a ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file in the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/client")," folder of the application. You can duplicate the ",(0,i.kt)("inlineCode",{parentName:"p"},".env.example")," in that folder, or create new one."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh",metastring:'title="/var/huddleup/huddle-up/config/client/.env"',title:'"/var/huddleup/huddle-up/config/client/.env"'},'# == BASE ==\nREACT_APP_HOST=https://huddle.huddle-up.org\nREACT_APP_API_URI=https://api.huddle.huddle-up.org\n\n# == i18n ==\nREACT_APP_I18N_DEFAULT_LOCALE=de\nREACT_APP_I18N_AVAILABLE_LOCALES="en,de"\n\n# == AUTH ==\nREACT_APP_HOST=https://huddle.huddle-up.org\nREACT_APP_API_URI=https://api.huddle.huddle-up.org\nREACT_APP_I18N_DEFAULT_LOCALE=en\nREACT_APP_OIDC_CLIENT_ID=someclientidprovidedbytheprovider\nREACT_APP_OIDC_CLIENT_SECRET=someclientsecretprovidedbytheprovider\nREACT_APP_OIDC_ISSUER=some.openidconnectprovider.test\nREACT_APP_OIDC_REDIRECT_URI=https://huddle.huddle-up.org/login/callback\nREACT_APP_OIDC_PROVIDER_NAME=Email\nREACT_APP_OIDC_PROVIDER_ICON=email\n')),(0,i.kt)("h3",{id:"backend"},"Backend"),(0,i.kt)("p",null,"Create a ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file in the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/client")," folder of the application. You can duplicate the ",(0,i.kt)("inlineCode",{parentName:"p"},".env.example")," in that folder, or create new one. Treat the ",(0,i.kt)("inlineCode",{parentName:"p"},"HU_AUTH_SECRET")," like a password and make sure it is strong enough."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh",metastring:'title="/var/huddleup/huddle-up/config/api/.env"',title:'"/var/huddleup/huddle-up/config/api/.env"'},"# == BASE ==\nHU_PORT=4000\nHU_HOST=https://api.huddle.huddle-up.org\n\n# == DATABASE ==\nHU_DB_USERNAME=huddleup\nHU_DB_PASSWORD=huddleupdbuserpassword\nHU_DB_DATABASE=huddleup\nHU_DB_HOST=localhost\nHU_DB_PORT=5432\n\n# == INTERNAL AUTH ==\nHU_AUTH_SECRET=JaqYL5rvacnpNy9uDV8muubcGE4pQNUS\n\n# == EXTERNAL AUTH (OIDC) ==\nHU_AUTH_OIDC_ISSUER_DOMAIN=some.openidconnectprovider.test\n# This is identical to your client id used in the frontend\nHU_AUTH_OIDC_AUDIENCE=someclientidprovidedbytheprovider\n\n# == JITSI ==\nHU_JITSI_HOST=https://meet.jit.si\n")),(0,i.kt)("h2",{id:"building-the-application"},"Building the Application"),(0,i.kt)("p",null,"After having written the configuration, we can build the application."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This process can take a while for the first time."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Folder: /var/huddleup/huddle-up"',title:'"Folder:','/var/huddleup/huddle-up"':!0},"yarn build\n")),(0,i.kt)("h3",{id:"running-migrations"},"Running migrations"),(0,i.kt)("p",null,"Before we can start the backend for the first time, we have to create the database schema."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Folder: /var/huddleup/huddle-up"',title:'"Folder:','/var/huddleup/huddle-up"':!0},"yarn migrate\n")),(0,i.kt)("h2",{id:"setup-pm2"},"Setup PM2"),(0,i.kt)("p",null,"To keep the backend running, and start it up automatically if you reboot the system we will be using ",(0,i.kt)("a",{parentName:"p",href:"https://pm2.keymetrics.io"},"PM2"),". We have already installed it in the first step, so we only have to set it up."),(0,i.kt)("p",null,"We will use the ",(0,i.kt)("a",{parentName:"p",href:"https://pm2.keymetrics.io/docs/usage/application-declaration/"},"ecosystem file")," feature of PM2 to declare the task in a easy to manage file. To do this, create a file in the parent directory of the application."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="/var/huddleup/pm2.config.yaml"',title:'"/var/huddleup/pm2.config.yaml"'},"apps:\n  - script: /var/huddleup/huddle-up/apps/api/dist/main.js\n    name: 'api'\n    watch: true\n")),(0,i.kt)("p",null,"Now we can start the backend for the first time!"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 start pm2.config.yaml\n")),(0,i.kt)("p",null,"You can check for the status of the process with ",(0,i.kt)("inlineCode",{parentName:"p"},"pm2 status")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"huddle-up/logs")," logs folder for errors."),(0,i.kt)("p",null,"To make sure that PM2 starts ",(0,i.kt)("em",{parentName:"p"},"HuddleUp")," on a server reboot, we'll add it to the startup processes. Run the following command and copy the output."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 startup\n")),(0,i.kt)("p",null,"Run the output ",(0,i.kt)("strong",{parentName:"p"},"as root")," and the automatic startup should be registered."),(0,i.kt)("h2",{id:"setup-nginx"},"Setup Nginx"),(0,i.kt)("p",null,"First, if you're still in the ",(0,i.kt)("inlineCode",{parentName:"p"},"huddleup")," user session, exit it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"exit\n")),(0,i.kt)("p",null,"For serving the client and forwarding requests to the backend, we will use Nginx. In a first step, we will setup the hosts for the two applications. Once these are set up, we'll setup HTTPS with Let's Encrypt."),(0,i.kt)("h3",{id:"basic-configuration"},"Basic Configuration"),(0,i.kt)("h4",{id:"client-host"},"Client Host"),(0,i.kt)("p",null,"Create a new Nginx configuration for the frontend at ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-available/000-stage.huddle-up.org.conf")," with following content:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-nginx",metastring:'title="/etc/nginx/sites-available/000-stage.huddle-up.org.conf"',title:'"/etc/nginx/sites-available/000-stage.huddle-up.org.conf"'},"server {\n    listen 80;\n    listen [::]:80;\n    root /var/huddleup/huddle-up/apps/client/build;\n    index index.html;\n    server_name huddle.huddle-up.org;\n    location / {\n        try_files $uri $uri/ /index.html =404;\n  }\n}\n")),(0,i.kt)("p",null,"Enable it by linking it into the ",(0,i.kt)("inlineCode",{parentName:"p"},"sites-enabled")," folder and reloading nginx."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ln -s /etc/nginx/sites-available/000-stage.huddle-up.org.conf /etc/nginx/sites-enabled/000-stage.huddle-up.org.conf\nservice nginx restart\n")),(0,i.kt)("h4",{id:"backend-host"},"Backend Host"),(0,i.kt)("p",null,"We'll do the same for the backend at `"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-nginx",metastring:'title="/etc/nginx/sites-available/000-api.stage.huddle-up.org.conf"',title:'"/etc/nginx/sites-available/000-api.stage.huddle-up.org.conf"'},'upstream api_upstream {\n  server 127.0.0.1:4000;\n  keepalive 64;\n}\n\nserver {\n  listen 80;\n  listen [::]:80;\n\n  server_name api.huddle.huddle-up.org;\n\n  location / {\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header Host $http_host; \n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";  \n    proxy_pass http://api_upstream/;\n    proxy_redirect off;\n    proxy_read_timeout 240s;\n  }\n}\n')),(0,i.kt)("p",null,"Enable it by linking it into the ",(0,i.kt)("inlineCode",{parentName:"p"},"sites-enabled")," folder and reloading nginx."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ln -s /etc/nginx/sites-available/000-api.stage.huddle-up.org.conf /etc/nginx/sites-enabled/000-api.stage.huddle-up.org.conf\nsudo service nginx restart\n\n")),(0,i.kt)("h3",{id:"lets-encrypt"},"Lets Encrypt"),(0,i.kt)("p",null,"To use HTTPS for connecting to the applications, we'll setup SSL certificates with Let's encrypt. We can let ",(0,i.kt)("inlineCode",{parentName:"p"},"certbot")," do the nginx configuration for us. When asked whether to always redirect, choose 'Yes'."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo certbot --nginx -d huddle.huddle-up.org\nsudo certbot --nginx -d api.huddle.huddle-up.org\n")),(0,i.kt)("p",null,"Finally, restart nginx for applying the changes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo service nginx restart\n")),(0,i.kt)("p",null,"And you're done! You should be able to use your ",(0,i.kt)("em",{parentName:"p"},"HuddleUp")," installation now."))}u.isMDXComponent=!0}}]);